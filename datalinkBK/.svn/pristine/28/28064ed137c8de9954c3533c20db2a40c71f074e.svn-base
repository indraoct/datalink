@extends('layouts.admin.default')

@section('css')
	<!-- BEGIN PAGE LEVEL STYLES -->
	<link href="{{ URL::asset('/assets/global/plugins/bootstrap-datepicker/css/datepicker3.css') }}" rel="stylesheet" type="text/css"/>
	<!-- END PAGE LEVEL SCRIPTS -->
@stop

@section('js')
	<!-- BEGIN PAGE LEVEL PLUGINS -->
	<script type="text/javascript" src="{{ URL::asset('/assets/global/plugins/bootbox/bootbox.min.js') }}"></script>
	<script type="text/javascript" src="{{ URL::asset('/assets/global/plugins/bootstrap-datepicker/js/bootstrap-datepicker.js') }}"></script>
	<script type="text/javascript" src="{{ URL::asset('/assets/global/plugins/moment.min.js') }}"></script>
        
	<!-- END PAGE LEVEL PLUGINS -->
	<script>
	
	function construct() {
	
		/*START JS FUNCTION */
                
                        /* DEFINE ELEMENT & OPTIONS HERE */

                        if (jQuery().datepicker) {
                            $('.date-picker').datepicker({
                                rtl: Metronic.isRTL(),
                                orientation: "left",
                                autoclose: true
                            });
                        }
                        
                        var lastToast;
                        
                        var itemColumns = [
					{ cTitle: "Item Code", cName: "item_code", cClass: "", cSize: 3 },
					{ cTitle: "Item Name", cName: "item_name", cClass: "", cSize: 6 }
				];

                        /* END DEFINE ELEMENT  */
                        
                        $("#cari_item").select2({
			placeholder: "Please Type item_code/item_name",
			allowClear: true,
			minimumInputLength: 1,
			ajax: {
				url: '{{ URL::to('/') }}/inventory/opname/get_select_list',
				dataType: 'json',
				type: "GET",
				quietMillis: 200,
				data: function (term) {
					return {
						term: term
					};
				},
				results: function (data) {
					return {results: data};
				}
			},
			formatResult: function (item) {
				
				var text = '<div class="row">';
				
				if(item.key === 0)
				{
					$.each(itemColumns, function (i, col) {
							
						text = text + '<div class="col-md-' + col.cSize + ' alignCenter"><strong>' + col.cTitle + '</strong></div>';
					});
				}
				
				$.each(itemColumns, function (i, col) {
						
					if (item[col.cName] === undefined)
						item[col.cName] = '';
					text = text + '<div class="col-md-' + col.cSize + ' '+col.cClass+'">' + item[col.cName] + '</div>';
				});
				
				return text + '</div>';
			},
			formatNoMatches: function(term) {
                               toastr.clear(lastToast);
			       toastr['error']("Input didn't match");	
                               return "Input didn't match";
                            }
		})
		.on("change", function(e) {
		
			var isExist = false;
			var $itemRow = {};
			$('.item_code').each(function (obj) {
				
				if($(this).val()==e.val)
				{
					isExist = true;
					$itemRow = $(this).closest('tr');
					return false;
				}
			});
			
			if(isExist)
			{
				var oldVal = defaultNumeric($itemRow.find('.qty').val(),{{ numericJS() }} );
				var newVal = displayNumeric(parseFloat(oldVal)+1,{{ numericJS() }} );
				$itemRow.find('.qty').val(newVal);
				recalculate();
				$('#cari_item').select2('val',''); 
			}
			else
				getRowProduk(e.val);
		})
		.parent().find('.select2-with-searchbox').on('click','#add_item',function(){
			
			var newTerm = $('#new_produk').val();
			$('#nama_item').val(newTerm);
			$('#modal_item').modal('show');
			$("#select2-drop-mask").click();
		});

                
                
		/* END JS FUNCTION */
                
                

	};
		
	jQuery(document).ready(function() {     
		Metronic.init(); // init metronic core components
		Layout.init(); // init current layout
		construct();
		
		@if(Session::get('alert')=='success')
			toastr['success']('{{ Session::get("alert_msg") }}');
		@endif
	});
	</script>
@stop
@section('content')
	<!-- BEGIN PAGE HEADER-->
	<div class="row">
		<div class="col-md-12">
			<!-- BEGIN PAGE TITLE & BREADCRUMB-->
			<h3 class="page-title">
			{{{ $title or '' }}} <small>{{{ $title_desc or '' }}}</small>
			</h3>
			<ul class="page-breadcrumb breadcrumb">
				<li>
					<i class="fa fa-home"></i>
					<a href="#">Inventory</a>
					<i class="fa fa-angle-right"></i>
				</li>
				<li>
						<a href="{{ URL::to('/') }}/inventory/opname">Stock Opname</a>
						<i class="fa fa-angle-right"></i>
                                </li>
                                <li>
                                        <a href="#">{{{ $title or '' }}}</a>
                                </li>
				
			</ul>
			<!-- END PAGE TITLE & BREADCRUMB-->
		</div>
	</div>
	<!-- END PAGE HEADER-->
        
        
	<!-- BEGIN PAGE CONTENT-->
	<div class="row">
		<div class="col-md-12">
                    <div class="row">
                        <div class="form-body">
                                  <div class="col-md-6">
                                      <label class="col-md-3">Date :</label>
                                          <div class="form-group col-md-4">  
                                               <div class="input-group date date-picker margin-bottom-5" data-date-format="{{ Config::get('format.date.default') }}">
                                                                            {{ Form::text('date','',array('class'=>'form-control form-filter input-sm','placeholder'=>'Date','readonly'=>true)) }}
                                                                            <span class="input-group-btn">
                                                                            <button class="btn btn-sm default" type="button"><i class="fa fa-calendar"></i></button>
                                                                            </span>
                                                </div>
                                          </div>
                                  </div>
                          </div>
                    </div>
                    <div class="row">
                      <div class="form-body">
                              <div class="col-md-6">
                                  <label class="col-md-3">Ref No :</label>
                                      <div class="form-group col-md-4">  
                                           {{ Form::text('ref_no','',array('class'=>'form-control form-filter input-sm','placeholder'=>'Ref No')) }}
                                      </div>
                              </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="form-body">
                              <div class="col-md-6">
                                  <label class="col-md-3">Note :</label>
                                      <div class="form-group col-md-4">  
                                           {{ Form::textarea('Note','',array('class'=>'form-control form-filter input-sm','placeholder'=>'Note','size'=>'10x3')) }}
                                      </div>
                              </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="form-body">
                           <div class="col-md-6">
                                  <label class="col-md-3">Search Item :</label>
                                      <div class="form-group col-md-6">  
                                            {{ Form::text('item_code','',array('id'=>'cari_item','class'=>'form-control')) }}
                                      </div>
                                      
                              </div>
                      </div>    
                    </div>
                    <div class="row">
					<div class="col-md-12">
						<div class="portlet"><div class="portlet-title">
               
			<div class="portlet-body">
                
					<div class="table-container">
						<table class="table table-striped table-bordered table-hover" id="datatable">
						<thead>
						<tr role="row" class="heading">
										<?php
											foreach($tableHeader as $content)
											{
												echo "<th>{$content['label']}</th>";
											}
										?>
                                                </tr>
						<tr role="row" class="filter">
                                                      <td>
                                                        
                                                      </td>
							<td>
								
							</td>
                                                        
							<td>
                                                            
								
							</td>
							<td>
								
							</td>
                                                        <td>
								
							</td>
                                                      
							<td>
								<button id="cari" class="btn btn-sm yellow filter-submit tooltips" data-original-title="Cari"><i class="fa fa-search"></i> </button>
								<button class="btn btn-sm red filter-cancel tooltips" data-original-title="Reset"><i class="fa fa-times"></i> </button>
							</td>
						</tr>
						</thead>
						<tbody>
						</tbody>
						</table>
					</div>
                            
                                        </div>
				</div>
                                                             
                             </div>
                         </div>
			<!-- End: life time stats -->
		</div>
	</div>
   </div>     
@stop